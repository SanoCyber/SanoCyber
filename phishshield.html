<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Use PhishShield to check emails for phishing scams with AI, brought to you by SanoCyber. Tailwind CSS version.">
  <meta name="keywords" content="PhishShield, email phishing checker, AI security tool, SanoCyber, Tailwind CSS">
  <meta name="author" content="SanoCyber">
  <title>PhishShield | Email Phishing Checker (Tailwind)</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Apply Inter font globally */
    body {
      font-family: 'Inter', sans-serif;
      color: #374151; /* Tailwind gray-700 */
    }
    /* Mobile nav 'active' class styles are in style.css (minimal_style_css_v1) */
  </style>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen">

<header class="bg-white shadow-md sticky top-0 z-50">
  <div class="container mx-auto px-4 flex items-center justify-between py-3">
    <a href="index.html" class="text-2xl font-bold text-blue-600 hover:text-blue-700 transition-colors">SanoCyber</a>
    <span class="nav-toggle md:hidden text-3xl text-gray-700 cursor-pointer" id="navToggle">&#9776;</span>
    <nav>
      <ul class="nav-links hidden md:flex space-x-6 items-center" id="navLinks">
        <li><a href="index.html" class="text-gray-600 hover:text-blue-600 font-medium transition-colors">Home</a></li>
        <li><a href="tools.html" class="text-gray-600 hover:text-blue-600 font-medium transition-colors">Toolkit</a></li>
        <li><a href="blog.html" class="text-gray-600 hover:text-blue-600 font-medium transition-colors">Blog</a></li>
        <li><a href="about.html" class="text-gray-600 hover:text-blue-600 font-medium transition-colors">Learn More</a></li>
        <li><a href="terms.html" class="text-gray-600 hover:text-blue-600 font-medium transition-colors">Terms</a></li>
        <li><a href="phishshield.html" class="text-blue-600 font-semibold border-b-2 border-blue-600 pb-1">PhishShield</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="flex-grow py-12 md:py-16 px-4">
  <div class="container mx-auto max-w-2xl bg-white p-6 md:p-8 rounded-xl shadow-xl" data-aos="fade-up">
    <h2 class="text-2xl md:text-3xl font-bold text-center mb-3 text-blue-700">PhishShield: Email Phishing Checker</h2>
    <p class="text-md text-center text-gray-600 mb-8">Scan emails for phishing threats using AI — free for up to 3 scans per day.</p>

    <div class="space-y-6">
      <div>
        <label for="emailText" class="block text-sm font-medium text-gray-700 mb-1">Paste suspicious email content:</label>
        <textarea id="emailText" placeholder="e.g., Your account was suspended..." rows="8" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out text-sm"></textarea>
      </div>

      <button onclick="analyzeEmail()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-md shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
        Analyze Email
      </button>
      
      <div id="limitWarning" style="display:none;" class="mt-4 p-4 bg-red-50 border border-red-200 text-red-700 rounded-md text-sm shadow">
        <p><strong class="font-semibold">⚠️ Scan Limit Reached:</strong> You've hit your free scan limit for today.</p>
        <p class="mt-1">Please <a href="https://buy.stripe.com/test_6oEg1ef5rfL4cGA3cc" target="_blank" rel="noopener noreferrer" class="font-semibold text-red-600 hover:text-red-800 underline">Upgrade to Pro</a> for unlimited scans and enhanced features.</p>
      </div>

      <div id="result" class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-md min-h-[60px] text-sm text-gray-700 shadow-inner whitespace-pre-wrap break-words">
        </div>
    </div>
  </div>
</main>

<footer class="bg-gray-800 text-gray-300 py-10 text-center mt-auto rounded-t-xl shadow-inner">
  <div class="container mx-auto">
    <p class="mb-4">&copy; <span id="year"></span> SanoCyber. All rights reserved.</p>
    <div class="social-icons">
      <a href="https://instagram.com/sanocyber" target="_blank" rel="noopener" class="inline-flex items-center mx-2 hover:text-sky-400 transition duration-300">
        <img src="https://placehold.co/30x30/ffffff/sky400?text=IG&font=fontawesome" alt="Instagram" class="w-7 h-7 rounded-full" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png'; this.onerror=null;">
        <span class="ml-2 sr-only">Instagram</span>
      </a>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script src="script.js"></script> 
<script>
  // PhishShield specific JavaScript (from original file, ensure it's compatible with new structure)
  const SCAN_LIMIT = 3; // Your original file said 3, but JS said 25. I've used 3 as per the text. Adjust if needed.
  const SCAN_KEY = 'phishshield-scan-count';
  const RESET_KEY = 'phishshield-scan-date';

  function resetDailyCount() {
    const today = new Date().toISOString().split('T')[0];
    localStorage.setItem(RESET_KEY, today);
    localStorage.setItem(SCAN_KEY, '0');
    console.log("Scan count reset for new day.");
  }

  function checkAndUpdateCount() {
    const today = new Date().toISOString().split('T')[0];
    const lastDate = localStorage.getItem(RESET_KEY);

    if (lastDate !== today) {
      resetDailyCount();
    }

    let count = parseInt(localStorage.getItem(SCAN_KEY) || '0', 10);
    console.log(`Current scan count: ${count}`);

    if (count >= SCAN_LIMIT) {
      console.log("Scan limit reached.");
      return false; // Limit reached
    }
    
    count++;
    localStorage.setItem(SCAN_KEY, String(count));
    console.log(`Scan count updated to: ${count}`);
    return true; // Scan allowed
  }

  async function analyzeEmail() {
    const emailTextElement = document.getElementById('emailText');
    const resultDiv = document.getElementById('result');
    const limitWarningDiv = document.getElementById('limitWarning');

    if (!emailTextElement || !resultDiv || !limitWarningDiv) {
        console.error("One or more required DOM elements are missing.");
        if(resultDiv) resultDiv.innerHTML = "<p class='text-red-600'>Client-side error: Page elements missing. Please refresh.</p>";
        return;
    }
    
    const emailText = emailTextElement.value.trim();

    if (!emailText) {
        resultDiv.innerHTML = "<p class='text-yellow-600'>Please paste some email content to analyze.</p>";
        return;
    }

    if (!checkAndUpdateCount()) {
      limitWarningDiv.style.display = 'block';
      resultDiv.innerHTML = ''; // Clear previous results
      return;
    }

    limitWarningDiv.style.display = 'none';
    resultDiv.innerHTML = "<p class='text-blue-600 animate-pulse'>Analyzing...</p>";

    try {
      // Ensure you replace 'YOUR_BACKEND_ENDPOINT' with your actual backend URL
      const response = await fetch('https://bitter-mud-23b3.glen-grevatt8855.workers.dev', { 
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ emailText }) // Ensure your backend expects { "emailText": "..." }
      });

      if (!response.ok) {
        // Attempt to get more detailed error from response body
        let errorData;
        try {
            errorData = await response.json();
        } catch (e) {
            // If response is not JSON, use status text
            errorData = { message: response.statusText };
        }
        throw new Error(`HTTP error ${response.status}: ${errorData.message || 'Failed to fetch analysis'}`);
      }
      
      const data = await response.json();
      // Ensure the output is treated as text to prevent XSS if 'data.result' contains HTML
      const preElement = document.createElement('pre');
      preElement.textContent = data.result || 'No valid response received from the analysis.';
      resultDiv.innerHTML = ''; // Clear "Analyzing..."
      resultDiv.appendChild(preElement);

    } catch (err) {
      console.error("Error analyzing email:", err);
      resultDiv.innerHTML = `<p class='text-red-600'><strong>Error:</strong> ${err.message || 'Could not connect to the analysis service. Please try again later.'}</p>`;
    }
  }

  // Initialize AOS (This might be in your script.js, if so, this is redundant)
  if (typeof AOS !== 'undefined') {
    AOS.init({
      duration: 800,
      once: true,
      offset: 50,
    });
  }

  // Mobile navigation toggle (example, ideally in script.js)
  const navToggle = document.getElementById('navToggle');
  const navLinks = document.getElementById('navLinks');
  if (navToggle && navLinks) {
    navToggle.addEventListener('click', () => {
      navLinks.classList.toggle('active'); // Relies on .active styles in style.css
    });
  }

  // Set current year in footer (example, ideally in script.js)
  const yearSpan = document.getElementById('year');
  if (yearSpan) {
    yearSpan.textContent = new Date().getFullYear();
  }
</script>
</body>
</html>
